/**
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 *
 * @format
<<<<<<< HEAD
 * @flow
=======
 * @flow strict-local
>>>>>>> e75a71e2c6ac3e5d484a463ebda2ebf8c6ccb707
 */

'use strict';

<<<<<<< HEAD
const InteractionManager = require('../Interaction/InteractionManager');
const NativeEventEmitter = require('../EventEmitter/NativeEventEmitter');
const Platform = require('../Utilities/Platform');

const invariant = require('invariant');

import NativeLinking from './NativeLinking';
=======
import NativeEventEmitter from '../EventEmitter/NativeEventEmitter';
import InteractionManager from '../Interaction/InteractionManager';
import Platform from '../Utilities/Platform';
import NativeLinkingManager from './NativeLinkingManager';
import NativeIntentAndroid from './NativeIntentAndroid';
import invariant from 'invariant';
import nullthrows from 'nullthrows';
>>>>>>> e75a71e2c6ac3e5d484a463ebda2ebf8c6ccb707

/**
 * `Linking` gives you a general interface to interact with both incoming
 * and outgoing app links.
 *
 * See https://reactnative.dev/docs/linking.html
 */
class Linking extends NativeEventEmitter {
  constructor() {
<<<<<<< HEAD
    super(NativeLinking);
=======
    super(Platform.OS === 'ios' ? nullthrows(NativeLinkingManager) : undefined);
>>>>>>> e75a71e2c6ac3e5d484a463ebda2ebf8c6ccb707
  }

  /**
   * Add a handler to Linking changes by listening to the `url` event type
   * and providing the handler
   *
   * See https://reactnative.dev/docs/linking.html#addeventlistener
   */
<<<<<<< HEAD
  addEventListener(type: string, handler: Function) {
=======
  addEventListener<T>(type: string, handler: T) {
>>>>>>> e75a71e2c6ac3e5d484a463ebda2ebf8c6ccb707
    this.addListener(type, handler);
  }

  /**
   * Remove a handler by passing the `url` event type and the handler.
   *
   * See https://reactnative.dev/docs/linking.html#removeeventlistener
   */
<<<<<<< HEAD
  removeEventListener(type: string, handler: Function) {
=======
  removeEventListener<T>(type: string, handler: T) {
>>>>>>> e75a71e2c6ac3e5d484a463ebda2ebf8c6ccb707
    this.removeListener(type, handler);
  }

  /**
   * Try to open the given `url` with any of the installed apps.
   *
   * See https://reactnative.dev/docs/linking.html#openurl
   */
<<<<<<< HEAD
  openURL(url: string): Promise<any> {
    this._validateURL(url);
    return NativeLinking.openURL(url);
=======
  openURL(url: string): Promise<void> {
    this._validateURL(url);
    if (Platform.OS === 'android') {
      return nullthrows(NativeIntentAndroid).openURL(url);
    } else {
      return nullthrows(NativeLinkingManager).openURL(url);
    }
>>>>>>> e75a71e2c6ac3e5d484a463ebda2ebf8c6ccb707
  }

  /**
   * Determine whether or not an installed app can handle a given URL.
   *
   * See https://reactnative.dev/docs/linking.html#canopenurl
   */
  canOpenURL(url: string): Promise<boolean> {
    this._validateURL(url);
<<<<<<< HEAD
    return NativeLinking.canOpenURL(url);
=======
    if (Platform.OS === 'android') {
      return nullthrows(NativeIntentAndroid).canOpenURL(url);
    } else {
      return nullthrows(NativeLinkingManager).canOpenURL(url);
    }
>>>>>>> e75a71e2c6ac3e5d484a463ebda2ebf8c6ccb707
  }

  /**
   * Open app settings.
   *
   * See https://reactnative.dev/docs/linking.html#opensettings
   */
<<<<<<< HEAD
  openSettings(): Promise<any> {
    return NativeLinking.openSettings();
=======
  openSettings(): Promise<void> {
    if (Platform.OS === 'android') {
      return nullthrows(NativeIntentAndroid).openSettings();
    } else {
      return nullthrows(NativeLinkingManager).openSettings();
    }
>>>>>>> e75a71e2c6ac3e5d484a463ebda2ebf8c6ccb707
  }

  /**
   * If the app launch was triggered by an app link,
   * it will give the link url, otherwise it will give `null`
   *
   * See https://reactnative.dev/docs/linking.html#getinitialurl
   */
  getInitialURL(): Promise<?string> {
    return Platform.OS === 'android'
      ? InteractionManager.runAfterInteractions().then(() =>
<<<<<<< HEAD
          NativeLinking.getInitialURL(),
        )
      : NativeLinking.getInitialURL();
=======
          nullthrows(NativeIntentAndroid).getInitialURL(),
        )
      : nullthrows(NativeLinkingManager).getInitialURL();
>>>>>>> e75a71e2c6ac3e5d484a463ebda2ebf8c6ccb707
  }

  /*
   * Launch an Android intent with extras (optional)
   *
   * @platform android
   *
   * See https://reactnative.dev/docs/linking.html#sendintent
   */
  sendIntent(
    action: string,
    extras?: Array<{
      key: string,
      value: string | number | boolean,
      ...
    }>,
  ): Promise<void> {
    if (Platform.OS === 'android') {
<<<<<<< HEAD
      return NativeLinking.sendIntent(action, extras);
    }
    return new Promise((resolve, reject) => reject(new Error('Unsupported')));
=======
      return nullthrows(NativeIntentAndroid).sendIntent(action, extras);
    } else {
      return new Promise((resolve, reject) => reject(new Error('Unsupported')));
    }
>>>>>>> e75a71e2c6ac3e5d484a463ebda2ebf8c6ccb707
  }

  _validateURL(url: string) {
    invariant(
      typeof url === 'string',
      'Invalid URL: should be a string. Was: ' + url,
    );
    invariant(url, 'Invalid URL: cannot be empty');
  }
}

module.exports = (new Linking(): Linking);
