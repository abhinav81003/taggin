/**
<<<<<<< HEAD
 * Copyright (c) 2015-present, Facebook, Inc.
=======
 * Copyright (c) Facebook, Inc. and its affiliates.
>>>>>>> e75a71e2c6ac3e5d484a463ebda2ebf8c6ccb707
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 *
 * @flow
 * @format
 */
<<<<<<< HEAD
=======

>>>>>>> e75a71e2c6ac3e5d484a463ebda2ebf8c6ccb707
'use strict';

import AnimatedValue from './AnimatedValue';
import AnimatedWithChildren from './AnimatedWithChildren';

import invariant from 'fbjs/lib/invariant';

<<<<<<< HEAD
type ValueXYListenerCallback = (value: {x: number, y: number}) => void;
=======
type ValueXYListenerCallback = (value: {
  x: number,
  y: number,
  ...
}) => mixed;
>>>>>>> e75a71e2c6ac3e5d484a463ebda2ebf8c6ccb707

let _uniqueId = 1;

/**
 * 2D Value for driving 2D animations, such as pan gestures. Almost identical
 * API to normal `Animated.Value`, but multiplexed.
 *
<<<<<<< HEAD
 * See http://facebook.github.io/react-native/docs/animatedvaluexy.html
=======
 * See https://reactnative.dev/docs/animatedvaluexy.html
>>>>>>> e75a71e2c6ac3e5d484a463ebda2ebf8c6ccb707
 */
class AnimatedValueXY extends AnimatedWithChildren {
  x: AnimatedValue;
  y: AnimatedValue;
<<<<<<< HEAD
  // $FlowFixMe
  _listeners: {[key: string]: {x: string, y: string}};

  constructor(
    valueIn?: ?{+x: number | AnimatedValue, +y: number | AnimatedValue},
=======
  _listeners: {
    [key: string]: {
      x: string,
      y: string,
      ...
    },
    ...,
  };

  constructor(
    valueIn?: ?{
      +x: number | AnimatedValue,
      +y: number | AnimatedValue,
      ...
    },
>>>>>>> e75a71e2c6ac3e5d484a463ebda2ebf8c6ccb707
  ) {
    super();
    const value: any = valueIn || {x: 0, y: 0}; // @flowfixme: shouldn't need `: any`
    if (typeof value.x === 'number' && typeof value.y === 'number') {
      this.x = new AnimatedValue(value.x);
      this.y = new AnimatedValue(value.y);
    } else {
      invariant(
        value.x instanceof AnimatedValue && value.y instanceof AnimatedValue,
        'AnimatedValueXY must be initialized with an object of numbers or ' +
          'AnimatedValues.',
      );
      this.x = value.x;
      this.y = value.y;
    }
    this._listeners = {};
  }

  /**
   * Directly set the value. This will stop any animations running on the value
   * and update all the bound properties.
   *
<<<<<<< HEAD
   * See http://facebook.github.io/react-native/docs/animatedvaluexy.html#setvalue
   */
  setValue(value: {x: number, y: number}) {
=======
   * See https://reactnative.dev/docs/animatedvaluexy.html#setvalue
   */
  setValue(value: {x: number, y: number, ...}) {
>>>>>>> e75a71e2c6ac3e5d484a463ebda2ebf8c6ccb707
    this.x.setValue(value.x);
    this.y.setValue(value.y);
  }

  /**
   * Sets an offset that is applied on top of whatever value is set, whether
   * via `setValue`, an animation, or `Animated.event`. Useful for compensating
   * things like the start of a pan gesture.
   *
<<<<<<< HEAD
   * See http://facebook.github.io/react-native/docs/animatedvaluexy.html#setoffset
   */
  setOffset(offset: {x: number, y: number}) {
=======
   * See https://reactnative.dev/docs/animatedvaluexy.html#setoffset
   */
  setOffset(offset: {x: number, y: number, ...}) {
>>>>>>> e75a71e2c6ac3e5d484a463ebda2ebf8c6ccb707
    this.x.setOffset(offset.x);
    this.y.setOffset(offset.y);
  }

  /**
   * Merges the offset value into the base value and resets the offset to zero.
   * The final output of the value is unchanged.
   *
<<<<<<< HEAD
   * See http://facebook.github.io/react-native/docs/animatedvaluexy.html#flattenoffset
=======
   * See https://reactnative.dev/docs/animatedvaluexy.html#flattenoffset
>>>>>>> e75a71e2c6ac3e5d484a463ebda2ebf8c6ccb707
   */
  flattenOffset(): void {
    this.x.flattenOffset();
    this.y.flattenOffset();
  }

  /**
   * Sets the offset value to the base value, and resets the base value to
   * zero. The final output of the value is unchanged.
   *
<<<<<<< HEAD
   * See http://facebook.github.io/react-native/docs/animatedvaluexy.html#extractoffset
=======
   * See https://reactnative.dev/docs/animatedvaluexy.html#extractoffset
>>>>>>> e75a71e2c6ac3e5d484a463ebda2ebf8c6ccb707
   */
  extractOffset(): void {
    this.x.extractOffset();
    this.y.extractOffset();
  }

<<<<<<< HEAD
  __getValue(): {x: number, y: number} {
=======
  __getValue(): {
    x: number,
    y: number,
    ...
  } {
>>>>>>> e75a71e2c6ac3e5d484a463ebda2ebf8c6ccb707
    return {
      x: this.x.__getValue(),
      y: this.y.__getValue(),
    };
  }

  /**
   * Stops any animation and resets the value to its original.
   *
<<<<<<< HEAD
   * See http://facebook.github.io/react-native/docs/animatedvaluexy.html#resetanimation
   */
  resetAnimation(callback?: (value: {x: number, y: number}) => void): void {
=======
   * See https://reactnative.dev/docs/animatedvaluexy.html#resetanimation
   */
  resetAnimation(
    callback?: (value: {
      x: number,
      y: number,
      ...
    }) => void,
  ): void {
>>>>>>> e75a71e2c6ac3e5d484a463ebda2ebf8c6ccb707
    this.x.resetAnimation();
    this.y.resetAnimation();
    callback && callback(this.__getValue());
  }

  /**
   * Stops any running animation or tracking. `callback` is invoked with the
   * final value after stopping the animation, which is useful for updating
   * state to match the animation position with layout.
   *
<<<<<<< HEAD
   * See http://facebook.github.io/react-native/docs/animatedvaluexy.html#stopanimation
   */
  stopAnimation(callback?: (value: {x: number, y: number}) => void): void {
=======
   * See https://reactnative.dev/docs/animatedvaluexy.html#stopanimation
   */
  stopAnimation(
    callback?: (value: {
      x: number,
      y: number,
      ...
    }) => void,
  ): void {
>>>>>>> e75a71e2c6ac3e5d484a463ebda2ebf8c6ccb707
    this.x.stopAnimation();
    this.y.stopAnimation();
    callback && callback(this.__getValue());
  }

  /**
   * Adds an asynchronous listener to the value so you can observe updates from
   * animations.  This is useful because there is no way to synchronously read
   * the value because it might be driven natively.
   *
   * Returns a string that serves as an identifier for the listener.
   *
<<<<<<< HEAD
   * See http://facebook.github.io/react-native/docs/animatedvaluexy.html#addlistener
   */
  // $FlowFixMe
=======
   * See https://reactnative.dev/docs/animatedvaluexy.html#addlistener
   */
>>>>>>> e75a71e2c6ac3e5d484a463ebda2ebf8c6ccb707
  addListener(callback: ValueXYListenerCallback): string {
    const id = String(_uniqueId++);
    const jointCallback = ({value: number}) => {
      callback(this.__getValue());
    };
    this._listeners[id] = {
      x: this.x.addListener(jointCallback),
      y: this.y.addListener(jointCallback),
    };
    return id;
  }

  /**
   * Unregister a listener. The `id` param shall match the identifier
   * previously returned by `addListener()`.
   *
<<<<<<< HEAD
   * See http://facebook.github.io/react-native/docs/animatedvaluexy.html#removelistener
=======
   * See https://reactnative.dev/docs/animatedvaluexy.html#removelistener
>>>>>>> e75a71e2c6ac3e5d484a463ebda2ebf8c6ccb707
   */
  removeListener(id: string): void {
    this.x.removeListener(this._listeners[id].x);
    this.y.removeListener(this._listeners[id].y);
    delete this._listeners[id];
  }

  /**
   * Remove all registered listeners.
   *
<<<<<<< HEAD
   * See http://facebook.github.io/react-native/docs/animatedvaluexy.html#removealllisteners
=======
   * See https://reactnative.dev/docs/animatedvaluexy.html#removealllisteners
>>>>>>> e75a71e2c6ac3e5d484a463ebda2ebf8c6ccb707
   */
  removeAllListeners(): void {
    this.x.removeAllListeners();
    this.y.removeAllListeners();
    this._listeners = {};
  }

  /**
   * Converts `{x, y}` into `{left, top}` for use in style.
   *
<<<<<<< HEAD
   * See http://facebook.github.io/react-native/docs/animatedvaluexy.html#getlayout
   */
  getLayout(): {[key: string]: AnimatedValue} {
=======
   * See https://reactnative.dev/docs/animatedvaluexy.html#getlayout
   */
  getLayout(): {[key: string]: AnimatedValue, ...} {
>>>>>>> e75a71e2c6ac3e5d484a463ebda2ebf8c6ccb707
    return {
      left: this.x,
      top: this.y,
    };
  }

  /**
   * Converts `{x, y}` into a useable translation transform.
   *
<<<<<<< HEAD
   * See http://facebook.github.io/react-native/docs/animatedvaluexy.html#gettranslatetransform
   */
  getTranslateTransform(): Array<{[key: string]: AnimatedValue}> {
=======
   * See https://reactnative.dev/docs/animatedvaluexy.html#gettranslatetransform
   */
  getTranslateTransform(): Array<{[key: string]: AnimatedValue, ...}> {
>>>>>>> e75a71e2c6ac3e5d484a463ebda2ebf8c6ccb707
    return [{translateX: this.x}, {translateY: this.y}];
  }
}

export default AnimatedValueXY;
