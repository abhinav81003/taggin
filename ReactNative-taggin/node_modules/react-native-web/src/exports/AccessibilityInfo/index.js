/**
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 *
 * @flow
 */

import { canUseDOM } from 'fbjs/lib/ExecutionEnvironment';

function isScreenReaderEnabled(): Promise<*> {
  return new Promise((resolve, reject) => {
    resolve(true);
  });
}

<<<<<<< HEAD
const prefersReducedMotionMedia = canUseDOM
  ? window.matchMedia('(prefers-reduced-motion: reduce)')
  : null;
=======
const prefersReducedMotionMedia =
  canUseDOM && typeof window.matchMedia === 'function'
    ? window.matchMedia('(prefers-reduced-motion: reduce)')
    : null;

>>>>>>> e75a71e2c6ac3e5d484a463ebda2ebf8c6ccb707
function isReduceMotionEnabled(): Promise<*> {
  return new Promise((resolve, reject) => {
    resolve(prefersReducedMotionMedia ? prefersReducedMotionMedia.matches : true);
  });
}

<<<<<<< HEAD
=======
function addChangeListener(fn) {
  if (prefersReducedMotionMedia != null) {
    prefersReducedMotionMedia.addEventListener != null
      ? prefersReducedMotionMedia.addEventListener('change', fn)
      : prefersReducedMotionMedia.addListener(fn);
  }
}

function removeChangeListener(fn) {
  if (prefersReducedMotionMedia != null) {
    prefersReducedMotionMedia.removeEventListener != null
      ? prefersReducedMotionMedia.removeEventListener('change', fn)
      : prefersReducedMotionMedia.removeListener(fn);
  }
}

>>>>>>> e75a71e2c6ac3e5d484a463ebda2ebf8c6ccb707
const handlers = {};

const AccessibilityInfo = {
  /**
   * Query whether a screen reader is currently enabled.
   *
   * Returns a promise which resolves to a boolean.
   * The result is `true` when a screen reader is enabled and `false` otherwise.
   */
  isScreenReaderEnabled,

  /**
   * Query whether the user prefers reduced motion.
   *
   * Returns a promise which resolves to a boolean.
   * The result is `true` when a screen reader is enabled and `false` otherwise.
   */
  isReduceMotionEnabled,

  /**
   * Deprecated
   */
  fetch: isScreenReaderEnabled,

  /**
   * Add an event handler. Supported events: reduceMotionChanged
   */
<<<<<<< HEAD
  addEventListener: function(eventName: string, handler: Function): Object {
=======
  addEventListener: function (eventName: string, handler: Function): Object {
>>>>>>> e75a71e2c6ac3e5d484a463ebda2ebf8c6ccb707
    if (eventName === 'reduceMotionChanged') {
      if (!prefersReducedMotionMedia) {
        return;
      }
<<<<<<< HEAD

      const listener = event => {
        handler(event.matches);
      };
      prefersReducedMotionMedia.addEventListener('change', listener);
=======
      const listener = (event) => {
        handler(event.matches);
      };
      addChangeListener(listener);
>>>>>>> e75a71e2c6ac3e5d484a463ebda2ebf8c6ccb707
      handlers[handler] = listener;
    }

    return {
      remove: () => AccessibilityInfo.removeEventListener(eventName, handler)
    };
  },

  /**
   * Set accessibility focus to a react component.
   */
<<<<<<< HEAD
  setAccessibilityFocus: function(reactTag: number): void {},
=======
  setAccessibilityFocus: function (reactTag: number): void {},
>>>>>>> e75a71e2c6ac3e5d484a463ebda2ebf8c6ccb707

  /**
   * Post a string to be announced by the screen reader.
   */
<<<<<<< HEAD
  announceForAccessibility: function(announcement: string): void {},
=======
  announceForAccessibility: function (announcement: string): void {},
>>>>>>> e75a71e2c6ac3e5d484a463ebda2ebf8c6ccb707

  /**
   * Remove an event handler.
   */
<<<<<<< HEAD
  removeEventListener: function(eventName: string, handler: Function): void {
=======
  removeEventListener: function (eventName: string, handler: Function): void {
>>>>>>> e75a71e2c6ac3e5d484a463ebda2ebf8c6ccb707
    if (eventName === 'reduceMotionChanged') {
      const listener = handlers[handler];
      if (!listener || !prefersReducedMotionMedia) {
        return;
      }
<<<<<<< HEAD

      prefersReducedMotionMedia.removeEventListener('change', listener);
    }

=======
      removeChangeListener(listener);
    }
>>>>>>> e75a71e2c6ac3e5d484a463ebda2ebf8c6ccb707
    return;
  }
};

export default AccessibilityInfo;
